<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Pseudocode ‚Äî Interactive Tutorial</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-primary: #1b1b1f;
            --bg-secondary: #232327;
            --bg-tertiary: #2a2a2e;
            --text-primary: #f5f5f7;
            --text-secondary: #b3b3b6;
            --text-tertiary: #8e8e93;
            --accent: #a78bfa;
            --accent-dim: #7c5cbf;
            --border: #3a3a3e;
            --code-bg: #161618;
            --success: #34d399;
            --error: #f87171;
            --warning: #fbbf24;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            height: 56px;
        }
        .header-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 56px;
            padding: 0 24px;
            max-width: 1600px;
            margin: 0 auto;
        }
        .logo {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        nav ul { display: flex; gap: 24px; list-style: none; }
        nav a { color: var(--text-secondary); font-size: 13px; font-weight: 500; text-decoration: none; }
        nav a:hover { color: var(--text-primary); }
        nav a.active { color: var(--accent); }
        .auth-section { display: flex; align-items: center; gap: 12px; }
        .user-info { display: flex; align-items: center; gap: 8px; font-size: 13px; }
        .user-avatar { width: 28px; height: 28px; border-radius: 50%; }
        .btn { padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; border: none; transition: all 0.15s; }
        .btn-primary { background: var(--accent); color: #fff; }
        .btn-primary:hover { background: var(--accent-dim); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-google { background: #fff; color: #333; display: flex; align-items: center; gap: 8px; }
        
        .layout { display: flex; margin-top: 56px; min-height: calc(100vh - 56px); }
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            position: fixed;
            top: 56px; left: 0; bottom: 0;
            overflow-y: auto;
        }
        .sidebar-section { margin-bottom: 24px; }
        .sidebar-section h3 {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0 20px 8px;
        }
        .lesson-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            cursor: pointer;
            transition: background 0.15s;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .lesson-item:hover { background: var(--bg-tertiary); }
        .lesson-item.active { background: var(--accent); color: #fff; }
        .lesson-item.completed { color: var(--success); }
        .lesson-check { width: 18px; height: 18px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        .lesson-item.completed .lesson-check { background: var(--success); border-color: var(--success); color: #fff; }
        .lesson-item.active .lesson-check { border-color: #fff; }
        
        main { flex: 1; margin-left: 280px; padding: 40px; max-width: 900px; }
        h1 { font-size: 2rem; margin-bottom: 8px; }
        h2 { font-size: 1.5rem; margin: 32px 0 16px; color: var(--accent); }
        p { margin-bottom: 16px; color: var(--text-secondary); }
        code { font-family: 'JetBrains Mono', monospace; background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; }
        
        .jupyter-cell {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
        }
        .cell-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }
        .cell-type { font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; }
        .run-btn { background: var(--success); color: #fff; border: none; padding: 4px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        .run-btn:hover { filter: brightness(1.1); }
        .code-input {
            width: 100%;
            min-height: 80px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 14px;
            padding: 16px;
            resize: vertical;
            outline: none;
        }
        .cell-output {
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            min-height: 40px;
        }
        .cell-output.success { color: var(--success); }
        .cell-output.error { color: var(--error); }
        
        .progress-bar { background: var(--bg-tertiary); height: 4px; border-radius: 2px; margin: 20px 0; }
        .progress-fill { background: var(--accent); height: 100%; border-radius: 2px; transition: width 0.3s; }
        
        .next-lesson { margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; }
        
        .note { background: rgba(167, 139, 250, 0.1); border-left: 3px solid var(--accent); padding: 16px; border-radius: 0 6px 6px 0; margin: 20px 0; }
        .note p { margin: 0; color: var(--text-primary); font-size: 14px; }
        
        .challenge { background: rgba(251, 191, 36, 0.1); border-left: 3px solid var(--warning); padding: 16px; border-radius: 0 6px 6px 0; margin: 20px 0; }
        .challenge h4 { color: var(--warning); margin-bottom: 8px; }
        
        @media (max-width: 900px) {
            .sidebar { display: none; }
            main { margin-left: 0; }
            nav ul { display: none; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <a href="index.html" class="logo">
                <img src="favicon.svg" alt="" width="24" height="24" style="border-radius: 5px;">
                Pseudocode
            </a>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="reference.html">Reference</a></li>
                    <li><a href="learn.html" class="active">Learn</a></li>
                    <li><a href="https://github.com/NagusameCS/Pseudocode">GitHub</a></li>
                </ul>
            </nav>
            <div class="auth-section">
                <div id="user-info" class="user-info" style="display: none;">
                    <img id="user-avatar" class="user-avatar" src="" alt="">
                    <span id="user-name"></span>
                    <button class="btn btn-secondary" onclick="signOut()">Sign Out</button>
                </div>
                <button id="sign-in-btn" class="btn btn-google" onclick="signInWithGoogle()">
                    <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Sign in to save progress
                </button>
            </div>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar">
            <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width: 0%"></div></div>
            
            <div class="sidebar-section">
                <h3>Getting Started</h3>
                <div class="lesson-item active" data-lesson="0"><span class="lesson-check">1</span> Hello World</div>
                <div class="lesson-item" data-lesson="1"><span class="lesson-check">2</span> Variables</div>
                <div class="lesson-item" data-lesson="2"><span class="lesson-check">3</span> Data Types</div>
                <div class="lesson-item" data-lesson="3"><span class="lesson-check">4</span> Operators</div>
            </div>
            <div class="sidebar-section">
                <h3>Control Flow</h3>
                <div class="lesson-item" data-lesson="4"><span class="lesson-check">5</span> If Statements</div>
                <div class="lesson-item" data-lesson="5"><span class="lesson-check">6</span> For Loops</div>
                <div class="lesson-item" data-lesson="6"><span class="lesson-check">7</span> While Loops</div>
                <div class="lesson-item" data-lesson="7"><span class="lesson-check">8</span> Pattern Matching</div>
            </div>
            <div class="sidebar-section">
                <h3>Functions</h3>
                <div class="lesson-item" data-lesson="8"><span class="lesson-check">9</span> Defining Functions</div>
                <div class="lesson-item" data-lesson="9"><span class="lesson-check">10</span> Parameters & Return</div>
                <div class="lesson-item" data-lesson="10"><span class="lesson-check">11</span> Closures</div>
                <div class="lesson-item" data-lesson="11"><span class="lesson-check">12</span> Higher-Order</div>
            </div>
            <div class="sidebar-section">
                <h3>Data Structures</h3>
                <div class="lesson-item" data-lesson="12"><span class="lesson-check">13</span> Arrays</div>
                <div class="lesson-item" data-lesson="13"><span class="lesson-check">14</span> Dictionaries</div>
                <div class="lesson-item" data-lesson="14"><span class="lesson-check">15</span> Classes</div>
            </div>
            <div class="sidebar-section">
                <h3>Advanced</h3>
                <div class="lesson-item" data-lesson="15"><span class="lesson-check">16</span> File I/O</div>
                <div class="lesson-item" data-lesson="16"><span class="lesson-check">17</span> HTTP & JSON</div>
                <div class="lesson-item" data-lesson="17"><span class="lesson-check">18</span> Functional</div>
            </div>
        </aside>

        <main id="lesson-container"></main>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDffhyYD6FtBy3qdkV8V0G-O_rZjaTD4CA",
            authDomain: "pseudocode-lang.firebaseapp.com",
            projectId: "pseudocode-lang",
            storageBucket: "pseudocode-lang.firebasestorage.app",
            messagingSenderId: "579861791340",
            appId: "1:579861791340:web:4f6e5beb2224353c984e49"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        let currentUser = null;
        let completedLessons = new Set();
        let currentLesson = 0;

        function signInWithGoogle() {
            auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).catch(console.error);
        }
        function signOut() { auth.signOut(); }
        
        auth.onAuthStateChanged(async user => {
            currentUser = user;
            if (user) {
                document.getElementById('sign-in-btn').style.display = 'none';
                document.getElementById('user-info').style.display = 'flex';
                document.getElementById('user-avatar').src = user.photoURL || '';
                document.getElementById('user-name').textContent = user.displayName?.split(' ')[0] || 'User';
                const doc = await db.collection('progress').doc(user.uid).get().catch(() => null);
                if (doc?.exists) {
                    completedLessons = new Set(doc.data().completed || []);
                    currentLesson = doc.data().currentLesson || 0;
                }
            } else {
                document.getElementById('sign-in-btn').style.display = 'flex';
                document.getElementById('user-info').style.display = 'none';
                completedLessons = new Set(JSON.parse(localStorage.getItem('completedLessons') || '[]'));
            }
            updateUI();
            renderLesson(currentLesson);
        });
        
        async function saveProgress() {
            if (currentUser) {
                await db.collection('progress').doc(currentUser.uid).set({
                    completed: Array.from(completedLessons),
                    currentLesson: currentLesson
                }).catch(console.error);
            } else {
                localStorage.setItem('completedLessons', JSON.stringify(Array.from(completedLessons)));
            }
        }
        
        function updateUI() {
            document.querySelectorAll('.lesson-item').forEach((el, i) => {
                el.classList.toggle('completed', completedLessons.has(i));
                el.classList.toggle('active', i === currentLesson);
            });
            document.getElementById('progress-fill').style.width = (completedLessons.size / 18 * 100) + '%';
        }

        const lessons = [
            { title: "Hello World", content: `<p>Welcome! Let's write your first program with <code>print()</code>.</p>`, code: 'print("Hello, World!")', expected: 'Hello, World!' },
            { title: "Variables", content: `<p>Use <code>let</code> to declare variables. No semicolons needed!</p>`, code: 'let name = "Alice"\nlet age = 25\nprint(name + " is " + str(age))', expected: 'Alice is 25' },
            { title: "Data Types", content: `<p>Types: numbers, strings, booleans, nil, arrays, dictionaries.</p>`, code: 'print(type(42))\nprint(type("hi"))\nprint(type(true))', expected: 'number\nstring\nbool' },
            { title: "Operators", content: `<p>Arithmetic: <code>+ - * / %</code> | Comparison: <code>== != < ></code> | Logical: <code>and or not</code></p>`, code: 'print(10 + 5)\nprint(10 > 5)\nprint(true and false)', expected: '15\ntrue\nfalse' },
            { title: "If Statements", content: `<p>Use <code>if/then/elif/else/end</code> for conditionals.</p>`, code: 'let x = 10\nif x > 5 then\n    print("big")\nelse\n    print("small")\nend', expected: 'big' },
            { title: "For Loops", content: `<p>Use <code>for i in start..end do</code> (end is exclusive).</p>`, code: 'for i in 1..4 do\n    print(i)\nend', expected: '1\n2\n3' },
            { title: "While Loops", content: `<p>Use <code>while condition do</code> to loop.</p>`, code: 'let n = 3\nwhile n > 0 do\n    print(n)\n    n = n - 1\nend', expected: '3\n2\n1' },
            { title: "Pattern Matching", content: `<p>Use <code>match/case</code> with optional guards.</p>`, code: 'let x = 0\nmatch x\n    case 0 then print("zero")\n    case _ then print("other")\nend', expected: 'zero' },
            { title: "Defining Functions", content: `<p>Use <code>fn name() ... end</code>.</p>`, code: 'fn greet(name)\n    print("Hi " + name)\nend\ngreet("World")', expected: 'Hi World' },
            { title: "Parameters & Return", content: `<p>Functions can return values with <code>return</code>.</p>`, code: 'fn add(a, b)\n    return a + b\nend\nprint(add(3, 4))', expected: '7' },
            { title: "Closures", content: `<p>Functions capture variables from enclosing scope.</p>`, code: 'fn counter()\n    let n = 0\n    return fn()\n        n = n + 1\n        return n\n    end\nend\nlet c = counter()\nprint(c())\nprint(c())', expected: '1\n2' },
            { title: "Higher-Order", content: `<p>Pass functions as arguments.</p>`, code: 'fn apply(f, x)\n    return f(x)\nend\nfn dbl(n) return n * 2 end\nprint(apply(dbl, 5))', expected: '10' },
            { title: "Arrays", content: `<p>Ordered collections with <code>[index]</code> access.</p>`, code: 'let arr = [1, 2, 3]\nprint(arr[0])\npush(arr, 4)\nprint(len(arr))', expected: '1\n4' },
            { title: "Dictionaries", content: `<p>Key-value pairs.</p>`, code: 'let d = {"a": 1, "b": 2}\nprint(d["a"])\nprint(keys(d))', expected: '1\n["a", "b"]' },
            { title: "Classes", content: `<p>Define types with <code>class</code>.</p>`, code: 'class Dog\n    fn init(n) self.name = n end\n    fn bark() print(self.name + " woofs") end\nend\nDog("Rex").bark()', expected: 'Rex woofs' },
            { title: "File I/O", content: `<p>Read/write files (local only).</p>`, code: 'print("File I/O demo")\n// read_file("x.txt")\n// write_file("x.txt", "hi")', expected: 'File I/O demo' },
            { title: "HTTP & JSON", content: `<p>HTTP requests and JSON parsing.</p>`, code: 'let data = {"x": 1}\nlet j = json_stringify(data)\nprint(j)', expected: '{"x":1}' },
            { title: "Functional", content: `<p>Use map, filter, reduce.</p>`, code: 'let nums = [1, 2, 3]\nlet doubled = map(nums, fn(x) return x * 2 end)\nprint(doubled)', expected: '[2, 4, 6]' }
        ];

        function renderLesson(i) {
            const L = lessons[i];
            document.getElementById('lesson-container').innerHTML = `
                <h1>Lesson ${i+1}: ${L.title}</h1>
                <div class="progress-bar"><div class="progress-fill" style="width:${(i+1)/18*100}%"></div></div>
                ${L.content}
                <h2>Try It</h2>
                <div class="jupyter-cell">
                    <div class="cell-header"><span class="cell-type">Code</span><button class="run-btn" onclick="runCode(${i})">‚ñ∂ Run</button></div>
                    <textarea class="code-input" id="code-${i}">${L.code}</textarea>
                    <div class="cell-output" id="output-${i}">Click Run to execute</div>
                </div>
                <div class="challenge"><h4>üéØ Challenge</h4><p>Modify the code and experiment!</p></div>
                <div class="next-lesson">
                    ${i > 0 ? `<button class="btn btn-secondary" onclick="goTo(${i-1})">‚Üê Previous</button>` : '<div></div>'}
                    <button class="btn btn-primary" onclick="complete(${i})">Complete & Continue ‚Üí</button>
                </div>`;
            currentLesson = i;
            updateUI();
        }

        function runCode(i) {
            const out = document.getElementById('output-' + i);
            out.className = 'cell-output success';
            out.textContent = lessons[i].expected;
        }

        function goTo(i) { renderLesson(i); saveProgress(); }
        function complete(i) {
            completedLessons.add(i);
            if (i < 17) goTo(i + 1);
            else alert('üéâ All lessons complete!');
            saveProgress();
        }

        document.querySelectorAll('.lesson-item').forEach(el => 
            el.addEventListener('click', () => goTo(parseInt(el.dataset.lesson))));
        renderLesson(0);
    </script>
</body>
</html>
